
.SILENT:

NAME=ConEmu
EXT =dll
RELEASEDIR=..\..\Release\plugins\ConEmu
NEEDENTRY = 1
USE_PDB = 1
NO_OPTIMIZE = 1
NEEDDEFLIB = 1

!include ../makefile_vc_defs

USERLIBS = kernel32.lib user32.lib gdi32.lib advapi32.lib shell32.lib version.lib

DEF_FILE = export.release.def

!if "$(CPU)" == "X86"
OUTNAME = ConEmu
!else
OUTNAME = ConEmu.x64
!endif





!ifndef DEBUG
CPP_OPT=$(CPP_OPT) /DNDEBUG /DHIDE_TODO
!else
CPP_OPT=$(CPP_OPT) /DDEBUG /D_DEBUG
!endif

!if "$(USE_PDB)" == "1"
CPP_OPT=$(CPP_OPT) /Fd$(PDB)
CPP_DEBUG=/Zi
LINK_DEBUG=/MAP:"$(MAP)" /DEBUG /PDB:$(PDB)
!else
CPP_DEBUG=
LINK_DEBUG=/MAP:"$(MAP)" /PDB:$(PDB)
!endif

#COMMONLIB=

!ifdef AMD64
CPP_PROJ_NO=/nologo /c /W3 /wd4995 /Gy /GF /Zp8 /J $(COMPAT64) /GS- /Gr /GR- /EHs-c- /LD $(ENV_INC_OPT) $(CPP_WIDE) /D_CRT_SECURE_NO_WARNINGS /D_CRT_NONSTDC_NO_WARNINGS /D_CRT_NON_CONFORMING_SWPRINTFS /D_WIN32_WINNT=0x0500 $(USERCPP)
#COMMONLIB = ../common/libCRT64.lib chkstk.obj
ULOUT=-Tpd+
LINK_MACHINE = /MACHINE:X64
!elseif defined(IA64)
CPP_PROJ_NO=/nologo /c /W3 /wd4995 /Gy /GF /Zp8 /J $(COMPAT64) /GS- /Gr /GR- /EHs-c- /LD $(ENV_INC_OPT) $(CPP_WIDE) /D_CRT_SECURE_NO_WARNINGS /D_CRT_NONSTDC_NO_WARNINGS /D_CRT_NON_CONFORMING_SWPRINTFS /D_WIN32_WINNT=0x0500 $(USERCPP)
#COMMONLIB = ../common/libCRTIA64.lib chkstk.obj
ULOUT=-Tpd+
LINK_MACHINE = /MACHINE:X64
!else
#COMMONLIB = ../common/libCRT.lib chkstk.obj
#../pvdCRT.lib
!ifdef CPP_UNALIGN
CPP_ALIGN=/Zp1
!endif
# /I"$(COMMON)"
CPP_PROJ_NO=/nologo /c /W3 /wd4995 /Gy /GF $(CPP_ALIGN) /J /Gr /GS- /GR- /EHs-c- /LD $(ENV_INC_OPT) $(CPP_WIDE) /D_CRT_SECURE_NO_WARNINGS /D_CRT_NONSTDC_NO_WARNINGS /D_CRT_NON_CONFORMING_SWPRINTFS /D_WIN32_WINNT=0x0500 $(USERCPP)
ULOUT=-Tpd -Re
LINK_MACHINE = /MACHINE:X86
!endif
CPP_PROJ=$(CPP_PROJ_NO) /Fo"$(INTDIR)\\"

LIBS = $(CRTLIB) $(USERLIBS)


LINK_FLAGS=/NOLOGO /SUBSYSTEM:WINDOWS /DYNAMICBASE /DLL /RELEASE $(LINK_MACHINE) $(NOWIN98) $(ENV_LIB_OPT) /DEF:"$(DEF)" /OUT:"$(OUTFULLNAME)" $(LINK_DEBUG)


CPPFLAGS = $(MP) $(CPP_PROJ) $(CPP_DEBUG) $(CPP_OPT)



!include ../makefile_vc_link


build: "$(OUTFULLNAME)"

"$(OUTFULLNAME)": $(LINK_OBJS) $(RES) $(LINK_DEP)
	@echo $(CLR_BRN)linking $@ :: $(LINK_FLAGS) $(LIBS)$(CLR_STD)
	$(LNK) @<<
	$(LINK_FLAGS) $(LIBS) $(LINK_OBJS) $(RES)
<<


$(RES): $(RC_NAME).rc
	@$(RC) $(ENV_INC_OPT) $(RC_WIDE) /fo"$(RES)" $(RC_NAME).rc




################

LINK_OBJS = \
$(INTDIR)\CEStr.obj \
$(INTDIR)\CmdLine.obj \
$(INTDIR)\Common.obj \
$(INTDIR)\ConEmuCheck.obj \
$(INTDIR)\ConEmuCheckEx.obj \
$(INTDIR)\ConEmuInjects.obj \
$(INTDIR)\ConEmuPlugin.obj \
$(INTDIR)\ConEmuPlugin1900.obj \
$(INTDIR)\ConEmuPlugin2800.obj \
$(INTDIR)\ConEmuPlugin995.obj \
$(INTDIR)\ConEmuPluginA.obj \
$(INTDIR)\ConEmuPluginBase.obj \
$(INTDIR)\EmergencyShow.obj \
$(INTDIR)\Execute.obj \
$(INTDIR)\HkFunc.obj \
$(INTDIR)\MAssert.obj \
$(INTDIR)\Memory.obj \
$(INTDIR)\Monitors.obj \
$(INTDIR)\MProcess.obj \
$(INTDIR)\MSection.obj \
$(INTDIR)\MSectionSimple.obj \
$(INTDIR)\MSecurity.obj \
$(INTDIR)\MSetter.obj \
$(INTDIR)\MStrDup.obj \
$(INTDIR)\MStrSafe.obj \
$(INTDIR)\PluginBackground.obj \
$(INTDIR)\PluginSrv.obj \
$(INTDIR)\SetEnvVar.obj \
$(INTDIR)\WConsole.obj \
$(INTDIR)\WFiles.obj \
$(INTDIR)\WModuleCheck.obj \
$(INTDIR)\WObjects.obj \
$(INTDIR)\WThreads.obj \
$(INTDIR)\WUser.obj


################
#LINK_OBJS begin

$(INTDIR)\CEStr.obj: ../common/CEStr.cpp ../common/CEStr.h

$(INTDIR)\CmdLine.obj: ../common/CmdLine.cpp

$(INTDIR)\Common.obj: ../common/Common.cpp

$(INTDIR)\ConEmuCheck.obj: ../common/ConEmuCheck.cpp

$(INTDIR)\ConEmuCheckEx.obj: ../common/ConEmuCheckEx.cpp

$(INTDIR)\ConEmuInjects.obj: ConEmuInjects.cpp

$(INTDIR)\ConEmuPlugin.obj: ConEmuPlugin.cpp

$(INTDIR)\ConEmuPlugin1900.obj: ConEmuPlugin1900.cpp

$(INTDIR)\ConEmuPlugin2800.obj: ConEmuPlugin2800.cpp

$(INTDIR)\ConEmuPlugin995.obj: ConEmuPlugin995.cpp

$(INTDIR)\ConEmuPluginA.obj: ConEmuPluginA.cpp

$(INTDIR)\ConEmuPluginBase.obj: ConEmuPluginBase.cpp ConEmuPluginBase.h

$(INTDIR)\EmergencyShow.obj: ../common/EmergencyShow.cpp ../common/EmergencyShow.h

$(INTDIR)\Execute.obj: ../common/execute.cpp

$(INTDIR)\HkFunc.obj: ../common/HkFunc.cpp ../common/HkFunc.h

$(INTDIR)\MAssert.obj: ../common/MAssert.cpp

$(INTDIR)\Memory.obj: ../common/Memory.cpp

$(INTDIR)\Monitors.obj: ../common/Monitors.cpp

$(INTDIR)\MProcess.obj: ../common/MProcess.cpp ../common/MProcess.h ../common/MToolHelp.h

$(INTDIR)\MSection.obj: ../common/MSection.cpp ../common/MSection.h

$(INTDIR)\MSectionSimple.obj: ../common/MSectionSimple.cpp ../common/MSectionSimple.h

$(INTDIR)\MSetter.obj: ../common/MSetter.cpp ../common/MSetter.h

$(INTDIR)\MStrDup.obj: ../common/MStrDup.cpp ../common/MStrDup.h

$(INTDIR)\MStrSafe.obj: ../common/MStrSafe.cpp

$(INTDIR)\PluginBackground.obj: PluginBackground.cpp

$(INTDIR)\PluginSrv.obj: PluginSrv.cpp ../common/PipeServer.h

$(INTDIR)\SetEnvVar.obj: ../common/SetEnvVar.cpp

$(INTDIR)\WConsole.obj: ../common/WConsole.cpp

$(INTDIR)\WFiles.obj: ../common/WFiles.cpp ../common/WFiles.h

$(INTDIR)\WModuleCheck.obj: ../common/WModuleCheck.cpp ../common/WModuleCheck.h

$(INTDIR)\WObjects.obj: ../common/WObjects.cpp

$(INTDIR)\WThreads.obj: ../common/WThreads.cpp ../common/WThreads.h

$(INTDIR)\WUser.obj: ../common/WUser.cpp

#LINK_OBJS end
##############
